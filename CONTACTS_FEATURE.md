# Добавление полей контактов в профиль пользователя

## Описание

Реализована возможность добавления контактных данных (Telegram, Discord, WhatsApp) в профиль пользователя для облегчения коммуникации при матчинге на собеседования.

## Что было реализовано

### 1. Обновлена сущность User
- **Файл**: `src/entities/User.ts`
- **Изменения**: Добавлены nullable поля:
  - `telegram` (VARCHAR, nullable)
  - `discord` (VARCHAR, nullable)
  - `whatsapp` (VARCHAR, nullable)

### 2. Создан API endpoint для профиля
- **Файл**: `app/api/user/profile/route.ts`
- **Методы**:
  - `GET` - получение профиля текущего пользователя (без пароля)
  - `PATCH` - обновление имени и контактных данных
- **Валидация**: Zod схема для безопасности данных
- **Авторизация**: Использует `requireAuthApi` и `getCurrentUser`

### 3. Создана страница редактирования профиля
- **Файл**: `app/profile/page.tsx`
- **Особенности**:
  - Client component с формой редактирования
  - Поля для имени, Telegram, Discord, WhatsApp
  - Автоматическая загрузка данных при монтировании
  - Сохранение через PATCH запрос
  - Перенаправление на /dashboard после успешного сохранения
  - Использование стилей проекта (glass эффект, градиенты)

### 4. Создан компонент UserContacts
- **Файл**: `components/user-contacts.tsx`
- **Функциональность**:
  - Отображение кнопок-ссылок на мессенджеры
  - Telegram: кликабельная ссылка на https://t.me/{username}
  - WhatsApp: кликабельная ссылка на https://wa.me/{phone}
  - Discord: отображение username (не кликабельно)
  - SVG иконки для каждого мессенджера
  - Цветовая схема: cyan для Telegram, indigo для Discord, emerald для WhatsApp
  - Компонент скрывается, если нет контактов

### 5. Интеграция UserContacts в существующие компоненты
Компонент добавлен в следующие места:

#### a. `components/card-details.tsx`
- Контакты создателя карточки (рядом с информацией о создателе)
- Контакты кандидатов в откликах

#### b. `app/dashboard/page.tsx`
- Контакты создателей карточек в списке откликов

#### c. `app/cards/[id]/accept/[applicationId]/page.tsx`
- Контакты кандидата при принятии отклика

### 6. Обновлен навбар
- **Файл**: `components/navbar.tsx`
- **Изменения**: Добавлена ссылка "Профиль" с иконкой User в меню для авторизованных пользователей

### 7. Создан скрипт миграции базы данных
- **Файл**: `scripts/add-contact-fields-migration.ts`
- **Назначение**: Добавление новых колонок в таблицу users
- **Особенности**: 
  - Проверяет наличие колонок перед добавлением
  - Можно запускать повторно без ошибок

## Миграция базы данных

### Запуск миграции

```bash
npx tsx scripts/add-contact-fields-migration.ts
```

Миграция добавит следующие колонки в таблицу `users`:
- `telegram` VARCHAR NULL
- `discord` VARCHAR NULL
- `whatsapp` VARCHAR NULL

### Альтернатива (если используется synchronize в dev)

Если в development режиме включен `synchronize: true` в настройках TypeORM, то колонки добавятся автоматически при следующем запуске приложения.

## Использование

### Для пользователей

1. **Редактирование профиля**:
   - Перейти в меню → "Профиль"
   - Заполнить контактные данные:
     - Telegram: username с @ или без (например: @username или username)
     - Discord: username с тегом (например: username#1234)
     - WhatsApp: номер в международном формате (например: +79991234567)
   - Нажать "Сохранить изменения"

2. **Просмотр контактов**:
   - Контакты отображаются автоматически на карточках собеседований
   - Видны создателю карточки и всем откликнувшимся
   - Для Telegram и WhatsApp - кликабельные кнопки-ссылки
   - Для Discord - отображается username для копирования

### Для разработчиков

#### Использование компонента UserContacts

```tsx
import { UserContacts } from "@/components/user-contacts";

// В вашем компоненте
<UserContacts user={userObject} />
```

Где `userObject` должен иметь структуру:
```typescript
{
  telegram?: string | null;
  discord?: string | null;
  whatsapp?: string | null;
}
```

#### Типы данных

Везде, где используется user объект и нужно отображать контакты, добавьте опциональные поля:

```typescript
interface User {
  // ... другие поля
  telegram?: string | null;
  discord?: string | null;
  whatsapp?: string | null;
}
```

## Особенности реализации

1. **Nullable поля**: Все контактные поля могут быть null, чтобы пользователи могли заполнять только нужные им
2. **Очистка данных**: 
   - Telegram username автоматически очищается от @ для формирования ссылки
   - WhatsApp номер очищается от форматирования, оставляя только цифры и +
3. **Условный рендеринг**: UserContacts не отображается, если у пользователя нет ни одного контакта
4. **Безопасность**: API проверяет авторизацию и валидирует данные через zod
5. **Дизайн**: Все компоненты используют единый стиль проекта (glass эффект, градиенты, цветовая схема slate)

## Дальнейшие улучшения

Возможные улучшения в будущем:
- Добавление Email как дополнительного способа связи
- Валидация форматов контактов на клиенте
- Настройки приватности (скрывать контакты от определенных пользователей)
- История изменений профиля
- Верификация контактов (подтверждение через код)
